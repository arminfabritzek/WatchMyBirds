{#
Detection Info Component

Shows detection/classification details.
For multi-detection images, shows all siblings as cards.

Args:
det (dict): Current detection with od_class_name, cls_class_name, confidences
siblings (list): List of sibling detections (if multi-detection image)
sibling_count (int): Total number of detections on this image
#}
{% macro render_detection_info(det, siblings=none, sibling_count=1) %}
<div class="detection-info small text-muted mt-2 text-center">
    {% if sibling_count and sibling_count > 1 and siblings %}
    {# Multiple detections on same image #}
    <div class="sibling-cards"
        style="display: flex; flex-wrap: wrap; justify-content: center; gap: 0.5rem; max-width: 100%;">
        {% for sib in siblings %}
        <div class="sibling-card" data-detection-id="{{ sib.detection_id }}" tabindex="-1"
            data-bbox-x="{{ sib.bbox_x }}" data-bbox-y="{{ sib.bbox_y }}" data-bbox-w="{{ sib.bbox_w }}"
            data-bbox-h="{{ sib.bbox_h }}" data-bbox-name="{{ sib.common_name }}" onmouseenter="showHoverBbox(this)"
            onmouseleave="hideHoverBbox(this)" style="
                position: relative;
                min-width: 160px; 
                max-width: 200px; 
                padding: 0.5rem; 
                border: 1px solid var(--color-border, #dee2e6); 
                border-radius: 0.375rem;
                text-align: left;
                cursor: pointer;
                transition: background 0.15s, border-color 0.15s;
             ">
            {% if sib.thumb_url %}
            <img src="{{ sib.thumb_url }}" alt="{{ sib.common_name }}"
                style="width: 36px; height: 36px; object-fit: cover; border-radius: 4px; float: left; margin-right: 8px;">
            {% endif %}
            <div style="font-weight: 600; font-size: 0.8rem;">{{ sib.common_name }}</div>
            <div style="font-size: 0.7rem; color: var(--color-text-muted, #6c757d);">
                {{ "%.0f"|format(sib.od_confidence * 100) }}%
                {% if sib.cls_class_name %} / {{ "%.0f"|format(sib.cls_confidence * 100) }}%{% endif %}
            </div>
            <button type="button"
                onclick="relabelDetection(event, {{ sib.detection_id }}, '{{ sib.cls_class_name or sib.od_class_name }}')"
                title="Relabel species"
                style="position:absolute;top:4px;right:24px;background:none;border:none;cursor:pointer;font-size:0.7rem;opacity:0.4;padding:2px 4px;border-radius:3px;transition:opacity 0.15s;"
                onmouseenter="this.style.opacity='1';this.style.background='rgba(167,139,250,0.15)'"
                onmouseleave="this.style.opacity='0.4';this.style.background='none'">üè∑Ô∏è</button>
            <button type="button" onclick="deleteDetection(event, {{ sib.detection_id }})" title="Delete this detection"
                style="position:absolute;top:4px;right:4px;background:none;border:none;cursor:pointer;font-size:0.7rem;opacity:0.4;padding:2px 4px;border-radius:3px;transition:opacity 0.15s;"
                onmouseenter="this.style.opacity='1';this.style.background='rgba(220,53,69,0.15)'"
                onmouseleave="this.style.opacity='0.4';this.style.background='none'">üóë</button>
            <div style="clear: both;"></div>
        </div>
        {% endfor %}
    </div>
    {% else %}
    {# Single detection - same card style as multi-detection #}
    <div class="sibling-cards"
        style="display: flex; flex-wrap: wrap; justify-content: center; gap: 0.5rem; max-width: 100%;">
        <div class="sibling-card" data-detection-id="{{ det.detection_id }}" tabindex="-1"
            data-bbox-x="{{ det.bbox_x }}" data-bbox-y="{{ det.bbox_y }}" data-bbox-w="{{ det.bbox_w }}"
            data-bbox-h="{{ det.bbox_h }}" data-bbox-name="{{ det.common_name }}" onmouseenter="showHoverBbox(this)"
            onmouseleave="hideHoverBbox(this)" style="
                position: relative;
                min-width: 160px; 
                max-width: 200px; 
                padding: 0.5rem; 
                border: 1px solid var(--color-border, #dee2e6); 
                border-radius: 0.375rem;
                text-align: left;
                cursor: pointer;
                transition: background 0.15s, border-color 0.15s;
             ">
            {% if det.display_path %}
            <img src="{{ det.display_path }}" alt="{{ det.common_name }}"
                style="width: 36px; height: 36px; object-fit: cover; border-radius: 4px; float: left; margin-right: 8px;">
            {% endif %}
            <div style="font-weight: 600; font-size: 0.8rem;">{{ det.common_name }}</div>
            <div style="font-size: 0.7rem; color: var(--color-text-muted, #6c757d);">
                {{ "%.0f"|format(det.od_confidence * 100) }}%
                {% if det.cls_class_name %} / {{ "%.0f"|format(det.cls_confidence * 100) }}%{% endif %}
            </div>
            <button type="button"
                onclick="relabelDetection(event, {{ det.detection_id }}, '{{ det.cls_class_name or det.od_class_name }}')"
                title="Relabel species"
                style="position:absolute;top:4px;right:24px;background:none;border:none;cursor:pointer;font-size:0.7rem;opacity:0.4;padding:2px 4px;border-radius:3px;transition:opacity 0.15s;"
                onmouseenter="this.style.opacity='1';this.style.background='rgba(167,139,250,0.15)'"
                onmouseleave="this.style.opacity='0.4';this.style.background='none'">üè∑Ô∏è</button>
            <button type="button" onclick="deleteDetection(event, {{ det.detection_id }})" title="Delete this detection"
                style="position:absolute;top:4px;right:4px;background:none;border:none;cursor:pointer;font-size:0.7rem;opacity:0.4;padding:2px 4px;border-radius:3px;transition:opacity 0.15s;"
                onmouseenter="this.style.opacity='1';this.style.background='rgba(220,53,69,0.15)'"
                onmouseleave="this.style.opacity='0.4';this.style.background='none'">üóë</button>
            <div style="clear: both;"></div>
        </div>
    </div>
    {% endif %}

</div>
{% endmacro %}